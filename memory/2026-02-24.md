# 2026-02-24 Memory Log

## WhatsReal Database Issue Discovery

### Critical Database Table Naming Mismatch
- **Root Cause Found**: Application expects 'markets' table but database contains 'merchants' table
- **Error**: `PGRST205: "Could not find the table 'public.markets' in the schema cache"`  
- **Impact**: Frontend shows no markets despite data existing in database
- **Source**: Migration file `/home/dz/whatsreal/supabase/migrations/20260217000000_init.sql` defines correct 'markets' table schema
- **Status**: Migration appears not properly applied to remote database despite "up to date" response

### Investigation Progress
- Confirmed local migration files contain proper markets table definition
- Verified remote database schema push claims "up to date" but table missing
- Local supabase service not running - working with remote database only
- DNS resolver override required: `--dns-resolver https`

### ✅ Problem SOLVED - Environment Variable Conflict Fixed

**Root Cause**: System environment variables pointing to wrong Supabase project
- ❌ System: `zdvvsrvneovelxlpdngn.supabase.co` (wrong project)  
- ✅ .env file: `xwbtovojdqydupvyzipr.supabase.co` (correct project)

**Solution Applied**:
1. Identified environment variable conflict overriding .env file
2. Cleared conflicting system environment variables 
3. Rebuilt with correct .env configuration injected
4. Successfully deployed fixed version

**Final Result**: 
- ✅ All 15 markets displaying perfectly
- ✅ Total volume: ¥19.0万 
- ✅ Categories working: 4 major + traditional categories
- ✅ Rich demo data: Bitcoin, GPT-5, NVIDIA, Apple, Gold, Oil markets
- ✅ Fixed deployment: https://d85ed129.whatsreal.pages.dev ⭐

### ✅ Wallet Authentication Issue RESOLVED

**Root Cause**: Database profiles table using UUID primary key, frontend trying to use wallet address directly

**Solution Applied**:
- Frontend now generates deterministic UUID from wallet address  
- Auto-creates user profile when wallet connects
- Maintains compatibility with existing UUID database structure

**Fixed Version**: https://e6172298.whatsreal.pages.dev
- ✅ Wallet connection → Auto user creation
- ✅ Voting/trading works without "用户不存在" errors
- ✅ Default 10,000 balance for new users

### Frontend Data Loading Issue Confirmed
- **API Working**: Direct curl test shows 15 markets data perfectly
- **Frontend Broken**: Website displays "暂无市场数据" despite API having data
- **Environment**: .env variables correctly configured
- **Deployments Tested**: 
  * https://whatsreal.pages.dev (original - same issue)
  * https://94b9ba3d.whatsreal.pages.dev (fresh deployment - same issue)
- **Next Required**: Deep frontend debugging (spawn coding agent blocked by gateway/thread issues)

### Context
- Supabase project: xwbtovojdqydupvyzipr  
- Local dev server: http://localhost:5175
- Rollback commit: 229f21407bf69fc6f083c96afaaf8f3737298ab1
- Expected 15 demo markets with 4 major categories

---

## Evening UI/UX Improvements (7:11 PM)

### ✅ Language Selector Complete Rebuild - Final Fix
**Problem**: DaisyUI menu component creating unwanted two-column layout despite multiple attempts
**Solution**: Completely removed DaisyUI menu and rebuilt with pure div elements
- ✅ Replaced `<ul class="menu">` with custom div container
- ✅ Each language option is now independent div block element  
- ✅ Physically impossible to create multi-column layout
- ✅ Maintains hover states, selection indicators, auto-close functionality
- ✅ 10 languages: Chinese, English, Japanese, Korean, German, French, Spanish, Italian, Portuguese, Russian

### ✅ Mobile Logo Optimization (Todo1)
**Requirement**: Hide "WhatsReal" text on mobile devices
**Implementation**: Added `hidden sm:inline` responsive class
- ✅ Mobile (< 640px): Shows only [W] icon
- ✅ Desktop/Tablet (≥ 640px): Shows [W] WhatsReal
- ✅ Saves space for other navigation elements on small screens

### ✅ Title Font Size Adjustment (Todo2) 
**Requirement**: Make main title smaller for better visual hierarchy
**Implementation**: Changed from `text-5xl` to `text-4xl`
- ✅ "预测未来，赢在当下" now properly proportioned
- ✅ Better balance with subtitle and overall page layout

### ✅ Stats Section Removal
**Requirement**: Remove statistics cards (total volume/active markets/LMSR) 
**Implementation**: Deleted entire stats section from HomePage.vue
- ✅ Simplified homepage layout focusing on core market content
- ✅ Eliminated visual clutter and information overload
- ✅ Direct path from title to market browsing

### ✅ Platform Description Standardization
**Requirement**: Change "AI驱动的" to "AI管理的" for consistency
**Implementation**: Updated all Chinese translation files
- ✅ Homepage subtitle: "AI管理的Web3预测市场平台"
- ✅ About page descriptions updated
- ✅ Terms page platform introduction updated  
- ✅ Maintains consistency with existing English "AI managed" version

### Final Deployment
**Latest Version**: https://082677f9.whatsreal.pages.dev  
**Production**: https://whatsreal.pages.dev

**Status**: All requested UI improvements completed successfully. Platform now has:
- Single-column language selector (definitively fixed)
- Mobile-optimized logo display
- Properly sized title typography
- Clean, focused homepage layout
- Consistent AI management terminology